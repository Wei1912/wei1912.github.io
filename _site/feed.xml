<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-01-23T23:48:48+09:00</updated><id>http://localhost:4000/feed.xml</id><entry><title type="html">Install Dns On Ubuntu18.04</title><link href="http://localhost:4000/2020/01/19/install-dns-on-ubuntu18.04.html" rel="alternate" type="text/html" title="Install Dns On Ubuntu18.04" /><published>2020-01-19T00:00:00+09:00</published><updated>2020-01-19T00:00:00+09:00</updated><id>http://localhost:4000/2020/01/19/install-dns-on-ubuntu18.04</id><content type="html" xml:base="http://localhost:4000/2020/01/19/install-dns-on-ubuntu18.04.html">&lt;h1 id=&quot;如何在-ubuntu-1804-安装-域名服务器&quot;&gt;如何在 Ubuntu 18.04 安装 域名服务器&lt;/h1&gt;

&lt;p&gt;通常我们访问某个网站，是在浏览器中输入这个网站的域名，比如 https://www.google.com/ ，但是在网络中，计算机需要知道其 IP 才可以通信。而域名服务器（Name server）可以进行 域名 和 IP 的转换。&lt;br /&gt;
接下来介绍如何在 Ubuntu 18.04 中安装 BIND9。BIND9 是 BIND 的当前最新版本，而 BIND 是最常使用的 DNS 软件。&lt;/p&gt;

&lt;h2 id=&quot;安装和配置-bind9&quot;&gt;安装和配置 BIND9&lt;/h2&gt;
&lt;h3 id=&quot;更新系统&quot;&gt;更新系统&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;安装-bind9&quot;&gt;安装 BIND9&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;bind9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;输入 y 继续安装。&lt;/p&gt;
&lt;h3 id=&quot;配置-bind9&quot;&gt;配置 BIND9&lt;/h3&gt;
&lt;p&gt;假设除域名服务器之外我们还有两台电脑，也是安装 Ubuntu 18.04 系统。两台电脑的 IP 分别是&lt;br /&gt;
  电脑A: 192.168.56.10&lt;br /&gt;
  电脑B: 192.168.56.11&lt;/p&gt;

&lt;p&gt;现在我想给它们分别赋予如下的域名，&lt;br /&gt;
  电脑A: app1.sample.com&lt;br /&gt;
  电脑B: app2.sample.com&lt;br /&gt;
域名可以随意指定，这里以 sample.com 作为例子。app1 和 app2 是主机名。&lt;/p&gt;
&lt;h4 id=&quot;1-配置-namedconfoptions&quot;&gt;1. 配置 named.conf.options&lt;/h4&gt;

&lt;p&gt;BIND9 的配置文件在 /etc/bind&lt;br /&gt;
所以我们先 cd 到这个目录&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/bind
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ls 这个目录会看到文件 named.conf.options\
用你喜欢的编辑器打开这个文件，比如说&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vi named.conf.options
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;把下面这些设定加入到这个配置文件&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;listen-on &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 192.168.56.3&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;192.168.56.3 是本机（域名服务器）的 IP 地址，BIND9 会监听本机的 53 端口，包括 127.0.0.1:53 和 192.168.56.3:53, 53 是 DNS 服务的默认端口。&lt;br /&gt;
由于我们只有一台域名服务器，没有同步的必要，所以将 allow-transfer 设置为 none。&lt;br /&gt;
编辑之后的样子：&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        directory &lt;span class=&quot;s2&quot;&gt;&quot;/var/cache/bind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        listen-on &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; localhost&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 192.168.56.3&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; none&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        // 以下默认设置
        dnssec-validation auto&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        auth-nxdomain no&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# conform to RFC1035&lt;/span&gt;
        listen-on-v6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; any&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;2-配置-zone&quot;&gt;2. 配置 zone&lt;/h4&gt;

&lt;p&gt;打开文件 named.conf.local，加入以下设定。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;zone &lt;span class=&quot;s2&quot;&gt;&quot;sample.com&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/zones/db.sample.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

zone &lt;span class=&quot;s2&quot;&gt;&quot;56.168.192.in-addr.arpa&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;master&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        file &lt;span class=&quot;s2&quot;&gt;&quot;/etc/bind/zones/db.56.168.192&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;注意最后的 ; 是必须的。
zone “sample.com” 是正向解析用 zone 配置，解析用的数据存储于 /etc/bind/zones/db.sample.com 文件。&lt;br /&gt;
sample.com 是域名，我们将在 db.sample.com 文件加入所有主机和对应的IP信息。&lt;/p&gt;

&lt;p&gt;zone “56.168.192.in-addr.arpa” 是反向解析用 zone 配置，我们假设我们的网络号是 192.168.56，注意这里要将其反过来写成 56.168.192.in-addr.arpa。in-addr.arpa 表示这是用于反向解析。解析用的数据存储于 /etc/bind/zones/db.56.168.192 文件。&lt;/p&gt;

&lt;h4 id=&quot;3-正向解析-zone-文件&quot;&gt;3. 正向解析 zone 文件&lt;/h4&gt;

&lt;p&gt;在 /etc/bind 目录下新建 zones 文件夹。&lt;br /&gt;
将 /etc/bind/db.empty 文件复制到 zones 文件夹，并重命名为 db.sample.com&lt;br /&gt;
编辑 db.sample.com 文件：&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt;    86400
@       IN      SOA     ns.sample.com. admin.sample.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                              1         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Serial
                         604800         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Refresh
                          86400         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Retry
                        2419200         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Expire
                          86400 &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Negative Cache TTL
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; name servers - NS records
        IN      NS      ns.sample.com.

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; name servers - A records
ns.sample.com.  IN      A       192.168.56.3

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; A records
app1    IN      A       192.168.56.10
app2    IN      A       192.168.56.11
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;4-反向解析-zone-文件&quot;&gt;4. 反向解析 zone 文件&lt;/h4&gt;

&lt;p&gt;将 /etc/bind/db.empty 文件再次复制到 zones 文件夹，并重命名为 db.56.168.192&lt;br /&gt;
编辑 db.56.168.192 文件：&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$TTL&lt;/span&gt;    86400
@       IN      SOA     ns.sample.com. admin.sample.com. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                              1         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Serial
                         604800         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Refresh
                          86400         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Retry
                        2419200         &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Expire
                          86400 &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;       &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Negative Cache TTL
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Name servers - NS records
        IN      NS      ns.sample.com.

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Name servers - PTR records
3       IN      PTR     ns.sample.com.

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; PTR records
10      IN      PTR     app1.sample.com.
11      IN      PTR     app2.sample.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;注意，如果你的网络号是 192.168，那么在 PTR 记录中，应当使用 10.56 这样的记录方式，就是将 IP 反过来。&lt;/p&gt;

&lt;h4 id=&quot;5-检查配置&quot;&gt;5. 检查配置&lt;/h4&gt;

&lt;p&gt;运行以下命令来检查 BIND9 配置文件。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;named-checkconf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;如果配置有错误，该命令会提示错误信息。&lt;/p&gt;

&lt;p&gt;运行以下命令检查正向解析 zone 文件配置。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;named-checkzone sample.com /etc/bind/zones/db.sample.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;named-checkzone 命令后跟两个参数，第一个是检查对象 zone 的名字，第二个是其 zone 文件。&lt;/p&gt;

&lt;p&gt;运行以下命令检查反向解析 zone 文件配置。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;named-checkzone 56.168.192.in-addr.arpa /etc/bind/zones/db.56.168.192
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;检查都通过的话那么配置就完成了。&lt;/p&gt;

&lt;h3 id=&quot;重起-bind9&quot;&gt;重起 BIND9&lt;/h3&gt;
&lt;p&gt;在我们安装完 BIND9 后，BIND9 就启动了。&lt;br /&gt;
运行以下命令重起 BIND9 服务，以使配置生效。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl restart bind9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;我们可以运行以下命令来查看当前 BIND9 的运行状态。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl status bind9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;检验效果&quot;&gt;检验效果&lt;/h3&gt;
&lt;p&gt;通常使用 nslookup 命令来查询DNS记录。&lt;br /&gt;
nslookup 后跟域名的时候，查询 A 记录，输出域名对应的 IP。&lt;br /&gt;
后跟 IP 的时候，查询 PTR 记录，输出 IP 对应的域名。&lt;br /&gt;
nslookup 还可以指定域名服务器。如果不指定的话，将使用系统的域名服务器。&lt;/p&gt;

&lt;p&gt;登陆到电脑A，输入以下命令&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nslookup app2.sample.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;由于我们还没有更改 电脑A 的系统域名服务器，所以上面的命令并不能给出正确的结果。&lt;br /&gt;
接下来运行命令 nslookup app2.sample.com 192.168.56.3&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xxx@app1:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nslookup app2.sample.com 192.168.56.3
Server:		192.168.56.3
Address:	192.168.56.3#53

Name:	app2.sample.com
Address: 192.168.56.11
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;可以看到，nslookup 向 192.168.56.3 查询 app2.sample.com 的DNS信息并给出了正确的 IP 地址。&lt;br /&gt;
我们也可以查询 PTR 信息。&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xxx@app1:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nslookup 192.168.56.10 192.168.56.3
10.56.168.192.in-addr.arpa	name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; app1.sample.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;更改系统域名服务器设定&quot;&gt;更改系统域名服务器设定&lt;/h3&gt;
&lt;p&gt;配置完域名服务器后，需要在其它的机器上设置DNS服务器信息，这样别的机器才可以使用配置完成的域名服务器的服务。&lt;br /&gt;
在电脑A，打开 /etc/netplan 目录下的配置文件，我是在 VirtualBox 上配置的虚拟机，所以配置文件是 50-cloud-init.yaml&lt;br /&gt;
将域名服务器信息添加到对应的网卡即可。&lt;br /&gt;
&lt;img src=&quot;/assets/images/install-dns-on-ubuntu18.04-01.png&quot; alt=&quot;name server setting&quot; width=&quot;600px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;运行 sudo netplan apply 使设定生效。
这时候再执行 nslookup app2.sample.com ，就可以得到想要的结果了。&lt;/p&gt;

&lt;p&gt;END&lt;/p&gt;</content><author><name></name></author><summary type="html">如何在 Ubuntu 18.04 安装 域名服务器</summary></entry></feed>